<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.0.1 (451119)"/><meta name="keywords" content="jekyll:bugfix, jekyll:e10s, jekyll:firefox, jekyll:mozilla, Needs export"/><meta name="author" content="dc2511"/><meta name="created" content="2014-07-17 18:12:40 +0000"/><meta name="source-url" content="https://bugzilla.mozilla.org/show_bug.cgi?id=921916"/><meta name="updated" content="2014-07-31 01:23:19 +0000"/><title>Bug 921916 - e10s support for Plugin events</title></head><body><div><a shape="rect" href="https://bugzilla.mozilla.org/show_bug.cgi?id=921916" target="_blank">https://bugzilla.mozilla.org/show_bug.cgi?id=921916</a><br clear="none"/></div><div><br clear="none"/></div><div>Q: What are the events that come up from the plugin binding? (2:30)<br clear="none"/></div><ul><li><strong>PluginRemoved</strong></li><li><strong>PluginBindingAttached</strong></li><li><strong>PluginCrashed</strong></li><li><strong>PluginInstantiated</strong></li><li><strong>PluginOutdated</strong></li><li><strong>Binding events:<br clear="none"/></strong><ul><li>PluginVulnerableUpdatable</li><li>PluginVulnerableNoUpdate</li><li>PluginClickToPlay</li><li>PluginPlayPreview</li><li>PluginDisabled<br clear="none"/></li><li>PluginNotFound</li><li>PluginBlocklisted<br clear="none"/></li></ul></li></ul><div>browser.js sets event handlers on a subset it seems:<br clear="none"/></div><div>    gBrowser.addEventListener("PluginBindingAttached", gPluginHandler, true, true);<br clear="none"/>    gBrowser.addEventListener("PluginCrashed",         gPluginHandler, true);<br clear="none"/>    gBrowser.addEventListener("PluginOutdated",        gPluginHandler, true);<br clear="none"/>    gBrowser.addEventListener("PluginInstantiated",    gPluginHandler, true);<br clear="none"/>    gBrowser.addEventListener("PluginRemoved",         gPluginHandler, true);</div><div><br clear="none"/></div><div>Q: How do the rest of the events get handled by gPluginHandler? (4:20)<br clear="none"/></div><div><br clear="none"/></div><div>The rest of the events are inferred in gPluginHandler by _getBindingType, which reads off the plugin.pluginFallbackType of plugin QI'd to Ci.nsIObjectLoadingContent.<br clear="none"/></div><div><br clear="none"/></div><div>This only occurs when the PluginBindingAttached event is fired.<br clear="none"/></div><div><br clear="none"/></div><div>Q: How much of what I'm trying to do has already been done by Android? (3:45)<br clear="none"/></div><div><br clear="none"/></div><div>It doesn't appear to be the same problem, or certainly not at the same scale. It looks like Android handles only the BindingAttached events, and even then, only some of them. Fennec doesn't do click-to-play, for example.<br clear="none"/></div><div><br clear="none"/></div><div><br clear="none"/></div><div>Q: What does gPluginsHandler do with the events that come up from a plugin binding? (10:00 + 29:00)<br clear="none"/></div><div><br clear="none"/></div><div><strong>PluginRemoved</strong></div><ul><li>Grabs the browser for the document that's passed in the event (that'd be CPOW'd for e10s)<br clear="none"/></li><li>Calls _setPluginNotificationIcon on that browser<br clear="none"/><ul><li>This'll do some logic to set the plugin charm in the URL bar.<br clear="none"/></li><li>This attempts to iterate the plugins on the contentWindow using DOMWindowUtils<br clear="none"/></li></ul></li></ul><div><strong>PluginBindingAttached</strong><br clear="none"/></div><ul><li><strong>Never actually gets handled. </strong>We just use this as a signal to convert to one of the other "binding" event types (PluginVulnerableUpdateable, PluginClickToPlay, etc).<br clear="none"/></li></ul><div><strong>PluginCrashed</strong><br clear="none"/></div><ul><li>Before we get this event, a chrome://mozapps/content/plugins/pluginProblem.xml#pluginProblem binding is attached to where the plugin was in the document<br clear="none"/></li><li>Gets a bunch of properties from a PropBag out of the event<br clear="none"/></li><li>Reaches into the document to get the anonymous plugin binding content to mess with it in multiple places. Yikes<br clear="none"/></li><li>If the plugin is too small or invisible, the messaging we were going to show in it gets sent up to a notification bar instead. Only a single instance of this plugin type needs to be big enough, and then we'll show the UI there and not show the notification bar.<br clear="none"/></li></ul><div><strong>PluginInstantiated</strong></div><ul><li>Goes ahead and shows the click-to-play UI<br clear="none"/></li></ul><div><strong>PluginOutdated</strong></div><ul><li>Goes ahead and shows the click-to-play UI<br clear="none"/></li></ul><div><strong>PluginVulnerableUpdatable</strong></div><ul><li>Sets the link for updating the plugin<br clear="none"/></li><li>The link is automatically displayed via CSS magic and the -moz-handler-vulnerable-updatable CSS pseudoselector<br clear="none"/></li><li>Goes ahead and shows the click-to-play UI<br clear="none"/></li></ul><div><strong>PluginVulnerableNoUpdate</strong></div><ul><li>No link for updating the plugin<br clear="none"/></li><li>Sets some vulnerability string within the content<br clear="none"/></li><li>Shows the click to play UI<br clear="none"/></li></ul><div><br clear="none"/></div><div>It turns out this will likely be fixed by <a shape="rect" href="https://bugzilla.mozilla.org/show_bug.cgi?id=899347">https://bugzilla.mozilla.org/show_bug.cgi?id=899347</a><br clear="none"/></div><div><br clear="none"/></div></body></html>